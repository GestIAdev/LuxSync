# ‚òÄÔ∏è WAVE 2042.1: CANONICAL ZONE UNIFICATION

**Fecha:** 14 Febrero 2026  
**Ejecutor:** PunkOpus  
**Comandante:** Radwulf  
**Fase:** Phase 0 del Proyecto Hyperion  
**Estado:** ‚úÖ COMPLETADO

---

## üìã RESUMEN EJECUTIVO

Phase 0 establece los cimientos de Hyperion:
1. **Un solo normalizador de zonas** ‚Äî `ShowFileV2.normalizeZone()`
2. **Un solo sistema de colores** ‚Äî `ZONE_COLORS` en `ZoneLayoutEngine.ts`
3. **Un solo motor de layout** ‚Äî `ZoneLayoutEngine.ts` para 2D y 3D
4. **Design tokens centralizados** ‚Äî `NeonPalette.ts`
5. **Tipos unificados** ‚Äî `types.ts`

---

## üìÅ ARCHIVOS CREADOS

### 1. `shared/ZoneLayoutEngine.ts` (330 l√≠neas)
**Single Source of Truth para posicionamiento de fixtures por zona.**

Contenido:
- Re-exports de `ShowFileV2`: `normalizeZone`, `CANONICAL_ZONES`, `ZONE_LABELS`, `CanonicalZone`
- **ZONE_COLORS** ‚Äî Colores neon para las 9 zonas can√≥nicas
- **ZONE_LAYOUT_2D** ‚Äî Posiciones relativas para canvas 2D (coordenadas 0-1)
- **ZONE_LAYOUT_3D** ‚Äî Posiciones en metros para escenario 3D
- **DEFAULT_STAGE_CONFIG** ‚Äî Dimensiones del escenario (12m √ó 8m √ó 5m)
- **Utility Functions:**
  - `resolveFixtureZone()` ‚Äî Wrapper sem√°ntico para normalizeZone
  - `distributeInRange()` ‚Äî Distribuci√≥n uniforme de fixtures
  - `groupByCanonicalZone()` ‚Äî Agrupaci√≥n de fixtures por zona
  - `calculatePosition2D()` ‚Äî Posici√≥n en canvas para un fixture
  - `calculatePosition3D()` ‚Äî Posici√≥n 3D para un fixture
  - `getDefaultPitch()` ‚Äî Inclinaci√≥n por defecto por zona
  - `isVerticalZone()` ‚Äî ¬øZona de movers laterales?
  - `hasStereoSplit()` ‚Äî ¬øZona con distribuci√≥n L/R?

### 2. `shared/NeonPalette.ts` (175 l√≠neas)
**Design tokens para el lenguaje visual Hyperion.**

Contenido:
- **HYPERION** ‚Äî Objeto con todos los tokens:
  - `bg.*` ‚Äî Fondos (void, surface, elevated, overlay)
  - `neon.*` ‚Äî Colores primarios (cyan, magenta, gold, green, red, purple)
  - `gradient.*` ‚Äî Gradientes CSS (toolbar, viewport, glow, beatPulse)
  - `grid.*` ‚Äî Colores del grid 2D (line, accent, cross)
  - `font.*` ‚Äî Tipograf√≠as (JetBrains Mono, Orbitron)
  - `border.*` ‚Äî Estilos de borde (subtle, normal, active, glow)
  - `glow.*` ‚Äî Box-shadows neon (cyan, magenta, beat)
  - `transition.*` ‚Äî Timing de animaciones (instant, fast, normal, smooth)
- **Utility Functions:**
  - `hexToRgba()` ‚Äî Hex a rgba con alpha
  - `generateGlow()` ‚Äî Genera box-shadow din√°mico
  - `getFixtureOffColor()` ‚Äî Color de fixture apagado
  - `getBeatColor()` ‚Äî Color interpolado cyan‚Üîmagenta

### 3. `shared/types.ts` (165 l√≠neas)
**Tipos unificados para componentes Hyperion.**

Tipos:
- `HyperionFixtureData` ‚Äî Datos de fixture para renderizado
- `QualityMode` ‚Äî 'HQ' | 'LQ'
- `QualitySettings` ‚Äî Config por modo de calidad
- `QUALITY_PRESETS` ‚Äî Presets HQ/LQ
- `ViewMode` ‚Äî '2D' | '3D'
- `HitTestResult` ‚Äî Resultado de click/hover
- `TooltipState` ‚Äî Estado del HUD T√°ctico
- `BeatState` ‚Äî Sincronizaci√≥n con m√∫sica

### 4. `shared/index.ts` (60 l√≠neas)
**Re-exports centralizados del m√≥dulo shared.**

---

## üîß ARCHIVOS MODIFICADOS

### 1. `controls/GroupsPanel.tsx`
**Fix cr√≠tico: Zone colors migrados a canonical.**

Cambios:
- Header actualizado a Hyperion
- Import cambiado a `../shared` 
- Eliminado `ZONE_COLORS` local (legacy names: `'ceiling-front'`, `'stage-left'`, etc.)
- `zoneMap` ahora es `Map<CanonicalZone, string[]>`
- Usa `normalizeZone(f.zone)` para normalizar
- Usa `ZONE_LABELS[zone]` para nombres legibles
- Usa `ZONE_COLORS[zone]` para colores (sin fallback necesario)

**Antes:**
```typescript
const ZONE_COLORS: Record<string, string> = {
  'ceiling-front': '#FFDD00',  // ‚ùå Legacy name ‚Äî NO existe en runtime
  'stage-left': '#00FFFF',     // ‚ùå Legacy name
  // ...
}
color: ZONE_COLORS[zone] || '#888888'  // Siempre fallback
```

**Despu√©s:**
```typescript
import { ZONE_COLORS, normalizeZone, type CanonicalZone } from '../shared'

const zone = normalizeZone(f.zone)  // ‚úÖ 'front', 'movers-left', etc.
color: ZONE_COLORS[zone]            // ‚úÖ Siempre existe
```

### 2. `simulator/index.ts`
**Actualizado para arquitectura Hyperion.**

Cambios:
- Header actualizado a Hyperion
- Exporta `shared/*` completo
- Exports de controls preservados
- Exports de views comentados (placeholder para fases futuras)
- Documentaci√≥n de exports eliminados (Scorched Earth)

### 3. `views/index.ts`
**Placeholder para nuevas vistas.**

Cambios:
- Eliminados exports de archivos purgeados
- Comentarios indicando qu√© se a√±adir√° en cada fase
- Documentaci√≥n de archivos eliminados

---

## üìä ESTAD√çSTICAS

| M√©trica | Valor |
|---------|-------|
| **Archivos creados** | 4 |
| **L√≠neas nuevas** | ~730 |
| **Archivos modificados** | 3 |
| **L√≠neas modificadas** | ~50 |
| **Bugs corregidos** | 1 (GroupsPanel zone colors) |
| **Build status** | ‚ö†Ô∏è BROKEN (views no exportadas ‚Äî esperado) |
| **TypeScript errors** | 0 (warnings de deprecation de TS7 ignorados) |

---

## ‚úÖ CRITERIOS DE √âXITO CUMPLIDOS

### Phase 0 Checklist:
- [x] `ZoneLayoutEngine.ts` creado con layouts 2D y 3D
- [x] `NeonPalette.ts` creado con todos los design tokens
- [x] `types.ts` creado con tipos unificados
- [x] `shared/index.ts` con re-exports centralizados
- [x] `GroupsPanel.tsx` corregido ‚Äî usa `ZONE_COLORS` canonical
- [x] `simulator/index.ts` actualizado ‚Äî exports placeholder
- [x] `views/index.ts` actualizado ‚Äî placeholder para fases futuras
- [x] ZERO errores TypeScript en archivos modificados/creados
- [x] Todos los imports funcionan correctamente

---

## üîú PR√ìXIMOS PASOS

### WAVE 2042.2: Phase 1 ‚Äî Neon Total Design System
1. **Crear `views/HyperionView.tsx`** ‚Äî Container principal
2. **Crear `views/HyperionView.css`** ‚Äî CSS Hyperion completo
3. **Actualizar exports** ‚Äî Activar `HyperionView` exports
4. **Backward compat** ‚Äî `StageViewDual` alias

### WAVE 2042.3: Phase 2 ‚Äî HUD T√°ctico
1. **Crear `views/tactical/FixtureTooltip.tsx`** ‚Äî Tooltip flotante
2. **Crear `views/tactical/FixtureTooltip.css`** ‚Äî Estilos neon

---

## üß¨ DEPENDENCIAS

### Verificadas:
- ‚úÖ `ShowFileV2.ts` ‚Äî `normalizeZone`, `CANONICAL_ZONES`, `ZONE_LABELS`, `CanonicalZone`
- ‚úÖ `stores/selectionStore` ‚Äî Selection logic
- ‚úÖ `stores/stageStore` ‚Äî Stage metadata
- ‚úÖ `stores/truthStore` ‚Äî Hardware data

### No requeridas (a√∫n):
- `three` ‚Äî Fase 4
- `@react-three/fiber` ‚Äî Fase 4
- `@react-three/postprocessing` ‚Äî Fase 4 (instalar)

---

## üìù COMMIT MESSAGE

```
‚òÄÔ∏è WAVE 2042.1: Phase 0 ‚Äî Canonical Zone Unification

PHASE 0 COMPLETE: Foundation for Project Hyperion.

CREATED:
- shared/ZoneLayoutEngine.ts ‚Äî Single source of truth for zone positioning
- shared/NeonPalette.ts ‚Äî Design tokens (HYPERION object)
- shared/types.ts ‚Äî Unified types (HyperionFixtureData, QualityMode, etc.)
- shared/index.ts ‚Äî Centralized exports

FIXED:
- GroupsPanel.tsx ‚Äî Zone colors migrated to canonical
  Before: ZONE_COLORS['ceiling-front'] ‚Üí fallback #888888
  After: ZONE_COLORS['front'] ‚Üí #FF6B35 (guaranteed)

UPDATED:
- simulator/index.ts ‚Äî Hyperion architecture, placeholder exports
- views/index.ts ‚Äî Placeholder for new views

BUILD: ‚ö†Ô∏è Broken (views not implemented ‚Äî expected until Phase 1)
ERRORS: 0 TypeScript errors

NEXT: WAVE 2042.2 (Phase 1 ‚Äî HyperionView.tsx + CSS)
```

---

**FIN DEL REPORTE ‚Äî PHASE 0 COMPLETE ‚òÄÔ∏è**

*"Los cimientos est√°n puestos. Ahora construimos la catedral."*
