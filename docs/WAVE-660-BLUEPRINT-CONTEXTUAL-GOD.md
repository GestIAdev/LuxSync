# ğŸ›ï¸ WAVE 660: BLUEPRINT "THE CONTEXTUAL GOD"
## Arquitectura para Conciencia Musical Contextual

**Fecha**: 16/01/2026  
**Autor**: PunkOpus (El Arquitecto de CÃ³digo)  
**Para**: Radwulf (El Visionario)  
**Objetivo**: Convertir Selene en un DSP de software que compita con GrandMA3

**Status**: âœ… APROBADO CON HONORES (MAGNA CUM LAUDE) - Ajustado con notas del CEO

---

## ğŸ”´ AJUSTES DEL CEO (CRÃTICOS)

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  PRIORIDAD #1: AGC PRIMERO O MORIMOS                              â•‘
â•‘  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â•‘
â•‘  WAVE 670 movido a FASE 0 (ejecutar antes de todo).               â•‘
â•‘  Sin AGC, los Z-Scores son ficciÃ³n matemÃ¡tica.                    â•‘
â•‘  Garbage In, Garbage Out.                                          â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘  PRIORIDAD #2: VISUALIZACIÃ“N DE DEBUG                             â•‘
â•‘  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â•‘
â•‘  AÃ±adida secciÃ³n 3.5: TacticalLog.logContextState()               â•‘
â•‘  Con tanta matemÃ¡tica (Z-Scores, Fuzzy, AGC gain), necesitamos    â•‘
â•‘  VER esos nÃºmeros en tiempo real.                                 â•‘
â•‘  Formato: "Z-Energy: +3.2Ïƒ" visible en consola.                   â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

**Veredicto CEO**: "Este documento no es solo cÃ³digo; es una DeclaraciÃ³n de Independencia del hardware caro."

---

## ğŸ¯ VISIÃ“N

> "GrandMA3 tiene hardware de $50K. Nosotros tenemos MATEMÃTICA."

Selene debe evolucionar de un sistema reactivo a un **orÃ¡culo musical contextual** que:
1. **SIENTE** el espectro completo (harshness, flatness, transientes)
2. **RECUERDA** la narrativa musical (Z-Score histÃ³rico)
3. **PREDICE** el futuro inmediato (drops, transiciones)
4. **DECIDE** con lÃ³gica difusa, no binaria

---

## ğŸ“ 1. LA NUEVA SINAPSIS (Data Flow Architecture)

### 1.1 Diagrama de Flujo Completo

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                            AUDIO CAPTURE                                     â”‚
â”‚                         (Web Audio API)                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â”‚ Float32Array (raw PCM)
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  LAYER 0: AUTOMATIC GAIN CONTROL (AGC)                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  AutomaticGainControl.update(rawBuffer)                               â”‚  â”‚
â”‚  â”‚  - Peak Tracking (decay 0.995/frame)                                  â”‚  â”‚
â”‚  â”‚  - NormalizaciÃ³n: buffer_norm = buffer / maxPeak                      â”‚  â”‚
â”‚  â”‚  - Floor: 0.10 (evita amplificaciÃ³n excesiva)                         â”‚  â”‚
â”‚  â”‚  OUTPUT: normalizedBuffer: Float32Array                               â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â”‚ normalizedBuffer
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  LAYER 1: FFT SPECTRAL ANALYSIS (GAMMA Worker)                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  FFTAnalyzer.analyze(normalizedBuffer)                                â”‚  â”‚
â”‚  â”‚  - Cooley-Tukey Radix-2 FFT (2048 bins)                               â”‚  â”‚
â”‚  â”‚  - Hanning Window (anti-leakage)                                      â”‚  â”‚
â”‚  â”‚  - Band Energy: subBass/bass/lowMid/mid/highMid/treble                â”‚  â”‚
â”‚  â”‚  - Spectral Metrics: centroid, dominantFreq                           â”‚  â”‚
â”‚  â”‚  - ğŸ†• Harshness: ratio 2-5kHz / total                                 â”‚  â”‚
â”‚  â”‚  - ğŸ†• Flatness: geometric_mean / arithmetic_mean                      â”‚  â”‚
â”‚  â”‚  - Transients: kick/snare/hihat detection                             â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                              â”‚
â”‚  OUTPUT: SpectralAnalysis                                                    â”‚
â”‚  {                                                                           â”‚
â”‚    bands: { bass, mid, treble, subBass, lowMid, highMid }                   â”‚
â”‚    spectral: { harshness, flatness, centroid, dominantFreq }                â”‚
â”‚    transients: { kick, snare, hihat }                                       â”‚
â”‚    energy: number (RMS total)                                               â”‚
â”‚  }                                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â”‚ postMessage (Worker â†’ Main)
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  LAYER 2: TRINITY BRAIN (Main Thread - Reception)                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  TrinityBrain.receiveFromGamma(spectralAnalysis)                      â”‚  â”‚
â”‚  â”‚  - Memory Buffer: Ãºltimos 5 segundos                                  â”‚  â”‚
â”‚  â”‚  - ğŸ†• Z-Score Calculator: detecta anomalÃ­as estadÃ­sticas              â”‚  â”‚
â”‚  â”‚  - ğŸ†• ContextualMemory: narrativa musical acumulada                   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                              â”‚
â”‚  OUTPUT: EnrichedMusicalContext                                             â”‚
â”‚  {                                                                           â”‚
â”‚    ...spectralAnalysis,                                                     â”‚
â”‚    zScores: { energy, bass, harshness }                                     â”‚
â”‚    narrativeContext: { phaseTrend, sectionHistory }                         â”‚
â”‚  }                                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  LAYER 3: TITAN ENGINE (Stabilization)                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  TitanEngine.update(enrichedContext)                                  â”‚  â”‚
â”‚  â”‚  - EnergyStabilizer: rawEnergy + smoothedEnergy (EMA 0.70)            â”‚  â”‚
â”‚  â”‚  - KeyStabilizer: lock 10s para evitar saltos                         â”‚  â”‚
â”‚  â”‚  - MoodArbiter: emotion + thermal temp                                â”‚  â”‚
â”‚  â”‚  - StrategyArbiter: color strategy                                    â”‚  â”‚
â”‚  â”‚  - ğŸ†• SpectralStabilizer: harshness/flatness smoothing                â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                              â”‚
â”‚  OUTPUT: TitanStabilizedState (EXTENDED)                                    â”‚
â”‚  {                                                                           â”‚
â”‚    rawEnergy, smoothedEnergy,                                               â”‚
â”‚    stableKey, stableEmotion, stableStrategy,                                â”‚
â”‚    thermalTemperature,                                                      â”‚
â”‚    bass, mid, high,                                                         â”‚
â”‚    bpm, beatPhase, syncopation,                                             â”‚
â”‚    sectionType,                                                             â”‚
â”‚    // ğŸ†• NUEVOS CAMPOS                                                      â”‚
â”‚    spectralHarshness: number,    // 0-1 (synth sucio)                       â”‚
â”‚    spectralFlatness: number,     // 0-1 (ruido vs tonal)                    â”‚
â”‚    energyZScore: number,         // DesviaciÃ³n estÃ¡ndar                     â”‚
â”‚    transients: { kick, snare, hihat }                                       â”‚
â”‚  }                                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  LAYER 4: SELENE TITAN CONSCIOUS (Intelligence)                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  SeleneTitanConscious.process(titanState)                             â”‚  â”‚
â”‚  â”‚                                                                        â”‚  â”‚
â”‚  â”‚  SENSE PHASE:                                                          â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚ MusicalPatternSensor â†’ SeleneMusicalPattern (EXTENDED)          â”‚  â”‚  â”‚
â”‚  â”‚  â”‚ BeautySensor â†’ SeleneBeauty                                     â”‚  â”‚  â”‚
â”‚  â”‚  â”‚ ConsonanceSensor â†’ ConsonanceScore                              â”‚  â”‚  â”‚
â”‚  â”‚  â”‚ ğŸ†• ContextualMemory.update() â†’ NarrativeContext                 â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â”‚                                                                        â”‚  â”‚
â”‚  â”‚  THINK PHASE:                                                          â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚ HuntEngine.hunt() â†’ HuntDecision                                â”‚  â”‚  â”‚
â”‚  â”‚  â”‚ ğŸ†• FuzzyDecisionMaker.evaluate() â†’ FuzzyScore                   â”‚  â”‚  â”‚
â”‚  â”‚  â”‚ ğŸ†• DropBridge.check() â†’ DropTrigger                             â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â”‚                                                                        â”‚  â”‚
â”‚  â”‚  DECIDE PHASE:                                                         â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚ DecisionMaker.decide(fuzzyScore, dropTrigger) â†’                 â”‚  â”‚  â”‚
â”‚  â”‚  â”‚   ConsciousnessOutput                                           â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                              â”‚
â”‚  OUTPUT: ConsciousnessOutput                                                â”‚
â”‚  {                                                                           â”‚
â”‚    effectDecision: { type: 'solar_flare', intensity, confidence }           â”‚
â”‚    colorDecision: { palette, strategy }                                     â”‚
â”‚    movementDecision: { pattern, speed }                                     â”‚
â”‚  }                                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.2 Interfaces TypeScript Propuestas

#### SpectralAnalysis (Output del FFT extendido)

```typescript
// src/workers/types.ts

/**
 * ğŸµ WAVE 660: AnÃ¡lisis Espectral Completo
 * Output del FFTAnalyzer con mÃ©tricas avanzadas
 */
export interface SpectralAnalysis {
  // === BANDAS DE FRECUENCIA ===
  bands: {
    subBass: number;   // 20-60 Hz (kicks profundos)
    bass: number;      // 60-250 Hz (graves)
    lowMid: number;    // 250-500 Hz
    mid: number;       // 500-2000 Hz (voz, instrumentos)
    highMid: number;   // 2000-4000 Hz (presencia)
    treble: number;    // 4000-20000 Hz (brillo)
  };
  
  // === MÃ‰TRICAS ESPECTRALES AVANZADAS ===
  spectral: {
    /** Ratio de energÃ­a en banda harsh (2-5kHz) vs total. 0=limpio, 1=distorsiÃ³n */
    harshness: number;
    
    /** Geometric mean / Arithmetic mean. 0=tonal, 1=ruido blanco */
    flatness: number;
    
    /** Centro de masa del espectro en Hz. Alto=brillante, Bajo=oscuro */
    centroid: number;
    
    /** Frecuencia con mayor energÃ­a en Hz */
    dominantFrequency: number;
  };
  
  // === DETECCIÃ“N DE TRANSIENTES ===
  transients: {
    /** Â¿Se detectÃ³ kick este frame? */
    kick: boolean;
    /** Â¿Se detectÃ³ snare este frame? */
    snare: boolean;
    /** Â¿Se detectÃ³ hihat este frame? */
    hihat: boolean;
    /** Intensidad del transiente mÃ¡s fuerte (0-1) */
    transientStrength: number;
  };
  
  // === ENERGÃA GLOBAL ===
  /** EnergÃ­a RMS total normalizada (0-1) */
  energy: number;
  
  /** Timestamp del anÃ¡lisis */
  timestamp: number;
}
```

#### TitanStabilizedState (Extendido)

```typescript
// src/core/intelligence/types.ts

/**
 * ğŸ”¥ WAVE 660: Estado Estabilizado Extendido
 * AÃ±ade mÃ©tricas espectrales y contextuales
 */
export interface TitanStabilizedState {
  // === CONTEXTO DEL VIBE ===
  vibeId: VibeId;
  constitution: GenerationOptions;
  
  // === DATOS ESTABILIZADOS (anti-epilepsia) ===
  stableKey: string | null;
  stableEmotion: MetaEmotion;
  stableStrategy: ColorStrategy;
  rawEnergy: number;      // GAMMA directo (WAVE 642)
  smoothedEnergy: number; // Smart Smooth EMA 0.70
  isDropActive: boolean;
  thermalTemperature: number;
  
  // === AUDIO EN TIEMPO REAL ===
  bass: number;
  mid: number;
  high: number;
  
  // === CONTEXTO MUSICAL ===
  bpm: number;
  beatPhase: number;
  syncopation: number;
  sectionType: SectionType;
  
  // === ğŸ†• WAVE 660: MÃ‰TRICAS ESPECTRALES ===
  spectralHarshness: number;  // 0-1 (synth sucio/distorsiÃ³n)
  spectralFlatness: number;   // 0-1 (ruido vs tonal)
  
  // === ğŸ†• WAVE 660: CONTEXTO ESTADÃSTICO ===
  energyZScore: number;       // DesviaciÃ³n estÃ¡ndar (-3 a +3 tÃ­pico)
  bassZScore: number;         // Para detectar kicks anÃ³malos
  
  // === ğŸ†• WAVE 660: TRANSIENTES ===
  transients: {
    kick: boolean;
    snare: boolean;
    hihat: boolean;
    strength: number;
  };
  
  // === PALETA Y TIMING ===
  currentPalette: SelenePalette;
  frameId: number;
  timestamp: number;
}
```

#### SeleneMusicalPattern (Extendido)

```typescript
// src/core/intelligence/types.ts

/**
 * ğŸ¼ WAVE 660: PatrÃ³n Musical Extendido
 * Incluye sentidos espectrales y contexto narrativo
 */
export interface SeleneMusicalPattern {
  // === CONTEXTO VIBE ===
  vibeId: VibeId;
  
  // === CLASIFICACIONES ===
  section: SectionClassification;
  energyPhase: EnergyPhase;
  
  // === MÃ‰TRICAS DE RITMO ===
  bpm: number;
  beatPhase: number;
  syncopation: number;
  rhythmicIntensity: number;
  
  // === MÃ‰TRICAS DE EMOCIÃ“N/TENSIÃ“N ===
  emotionalTension: number;
  isBuilding: boolean;
  isReleasing: boolean;
  
  // === MÃ‰TRICAS DE ARMONÃA ===
  harmonicDensity: number;
  
  // === BANDAS DE FRECUENCIA ===
  bassPresence: number;
  midPresence: number;
  highPresence: number;
  
  // === ENERGÃA (WAVE 642) ===
  rawEnergy: number;
  smoothedEnergy: number;
  
  // === DROP STATE ===
  isDropActive: boolean;
  distanceFromDrop: number;
  
  // === ğŸ†• WAVE 660: SENTIDOS ESPECTRALES ===
  spectralHarshness: number;   // 0-1
  spectralFlatness: number;    // 0-1
  spectralBrightness: number;  // Derivado del centroid (0-1)
  
  // === ğŸ†• WAVE 660: CONTEXTO ESTADÃSTICO ===
  energyZScore: number;        // Â¿CuÃ¡n anÃ³mala es la energÃ­a actual?
  isStatisticalAnomaly: boolean; // |zScore| > 2.5
  
  // === ğŸ†• WAVE 660: TRANSIENTES ===
  hasKick: boolean;
  hasSnare: boolean;
  hasHihat: boolean;
  transientDensity: number;    // Transientes por segundo
  
  // === ğŸ†• WAVE 660: CONTEXTO NARRATIVO ===
  narrativePhase: 'intro' | 'building' | 'climax' | 'release' | 'outro';
  sectionAge: number;          // ms desde inicio de secciÃ³n actual
  predictedNextSection: SectionType | null;
  predictionConfidence: number;
  
  // === TIMING ===
  timestamp: number;
}
```

---

## ğŸ§  2. LA MEMORIA CONTEXTUAL (The Hippocampus)

### 2.1 Arquitectura de ContextualMemory

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  CONTEXTUAL MEMORY - "El Hipocampo de Selene"                               â”‚
â”‚  src/core/intelligence/memory/ContextualMemory.ts                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  ROLLING STATS BUFFER (EstadÃ­sticas Rodantes)                       â”‚    â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚    â”‚
â”‚  â”‚  - Circular Buffer: Ãºltimos 300 frames (~5 segundos @ 60fps)        â”‚    â”‚
â”‚  â”‚  - MÃ©tricas trackeadas:                                             â”‚    â”‚
â”‚  â”‚    â€¢ energy: mean, stdDev, min, max                                 â”‚    â”‚
â”‚  â”‚    â€¢ bass: mean, stdDev, min, max                                   â”‚    â”‚
â”‚  â”‚    â€¢ harshness: mean, stdDev                                        â”‚    â”‚
â”‚  â”‚    â€¢ transientCount: suma de kicks+snares en ventana                â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚  OUTPUT: RollingStats {                                             â”‚    â”‚
â”‚  â”‚    energy: { mean, stdDev, min, max, current, zScore }              â”‚    â”‚
â”‚  â”‚    bass: { mean, stdDev, min, max, current, zScore }                â”‚    â”‚
â”‚  â”‚    harshness: { mean, stdDev, current }                             â”‚    â”‚
â”‚  â”‚    transientRate: number (transients/second)                        â”‚    â”‚
â”‚  â”‚  }                                                                  â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  SECTION HISTORY TRACKER (Narrativa Musical)                        â”‚    â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚    â”‚
â”‚  â”‚  - IntegraciÃ³n con SectionTracker.getSectionHistory()               â”‚    â”‚
â”‚  â”‚  - Ãšltimas 8 secciones con timestamps y duraciÃ³n                    â”‚    â”‚
â”‚  â”‚  - DetecciÃ³n de patrones: buildupâ†’buildup = DROP INCOMING           â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚  OUTPUT: NarrativeContext {                                         â”‚    â”‚
â”‚  â”‚    currentSection: SectionType                                      â”‚    â”‚
â”‚  â”‚    sectionAge: number (ms)                                          â”‚    â”‚
â”‚  â”‚    sectionHistory: SectionHistoryEntry[]                            â”‚    â”‚
â”‚  â”‚    narrativePhase: 'intro' | 'building' | 'climax' | 'release'      â”‚    â”‚
â”‚  â”‚    predictedNext: { section: SectionType, probability: number }     â”‚    â”‚
â”‚  â”‚  }                                                                  â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  ANOMALY DETECTOR (Detector de Momentos Ã‰picos)                     â”‚    â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚    â”‚
â”‚  â”‚  - Z-Score Thresholds:                                              â”‚    â”‚
â”‚  â”‚    â€¢ |z| > 1.5 = Notable                                            â”‚    â”‚
â”‚  â”‚    â€¢ |z| > 2.0 = Significativo                                      â”‚    â”‚
â”‚  â”‚    â€¢ |z| > 2.5 = AnomalÃ­a (DROP/BREAKDOWN)                          â”‚    â”‚
â”‚  â”‚    â€¢ |z| > 3.0 = Momento Ã‰pico (FORCE STRIKE)                       â”‚    â”‚
â”‚  â”‚                                                                      â”‚    â”‚
â”‚  â”‚  OUTPUT: AnomalyReport {                                            â”‚    â”‚
â”‚  â”‚    isAnomaly: boolean                                               â”‚    â”‚
â”‚  â”‚    type: 'spike' | 'drop' | 'sustained_high' | 'sustained_low'      â”‚    â”‚
â”‚  â”‚    severity: number (1.5 - 4.0)                                     â”‚    â”‚
â”‚  â”‚    metrics: { energy, bass, harshness }                             â”‚    â”‚
â”‚  â”‚  }                                                                  â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 Interface TypeScript: ContextualMemory

```typescript
// src/core/intelligence/memory/ContextualMemory.ts

/**
 * ğŸ§  WAVE 660: CONTEXTUAL MEMORY
 * "El Hipocampo de Selene" - Memoria contextual para entender la narrativa musical
 */

export interface RollingStats {
  mean: number;
  stdDev: number;
  min: number;
  max: number;
  current: number;
  zScore: number;  // (current - mean) / stdDev
}

export interface MetricStats {
  energy: RollingStats;
  bass: RollingStats;
  harshness: RollingStats;
  transientRate: number;  // transients per second
}

export interface SectionHistoryEntry {
  type: SectionType;
  startTime: number;
  endTime: number | null;
  duration: number;
  avgEnergy: number;
  peakEnergy: number;
}

export interface NarrativeContext {
  currentSection: SectionType;
  sectionAge: number;
  sectionHistory: SectionHistoryEntry[];
  narrativePhase: 'intro' | 'building' | 'climax' | 'release' | 'outro';
  predictedNext: {
    section: SectionType;
    probability: number;
    estimatedTimeMs: number;
  } | null;
}

export interface AnomalyReport {
  isAnomaly: boolean;
  type: 'spike' | 'drop' | 'sustained_high' | 'sustained_low' | 'none';
  severity: number;  // 0-4 (0=normal, 4=Ã©pico)
  affectedMetrics: ('energy' | 'bass' | 'harshness')[];
  recommendation: 'ignore' | 'prepare' | 'strike' | 'force_strike';
}

export interface ContextualMemoryConfig {
  /** TamaÃ±o del buffer circular en frames (default: 300 = 5s @ 60fps) */
  bufferSize: number;
  
  /** Z-Score threshold para anomalÃ­a (default: 2.5) */
  anomalyThreshold: number;
  
  /** Z-Score threshold para momento Ã©pico (default: 3.0) */
  epicThreshold: number;
  
  /** TamaÃ±o del historial de secciones (default: 8) */
  sectionHistorySize: number;
}

export class ContextualMemory {
  private config: ContextualMemoryConfig;
  
  // Buffers circulares
  private energyBuffer: CircularBuffer<number>;
  private bassBuffer: CircularBuffer<number>;
  private harshnessBuffer: CircularBuffer<number>;
  private transientBuffer: CircularBuffer<boolean>;
  
  // Estado
  private sectionHistory: SectionHistoryEntry[] = [];
  private currentSectionStart: number = 0;
  private frameCount: number = 0;
  
  constructor(config: Partial<ContextualMemoryConfig> = {});
  
  /**
   * Actualiza la memoria con un nuevo frame
   */
  update(input: {
    energy: number;
    bass: number;
    harshness: number;
    hasTransient: boolean;
    sectionType: SectionType;
    timestamp: number;
  }): void;
  
  /**
   * Obtiene las estadÃ­sticas rodantes actuales
   */
  getStats(): MetricStats;
  
  /**
   * Obtiene el contexto narrativo
   */
  getNarrativeContext(): NarrativeContext;
  
  /**
   * Detecta anomalÃ­as basadas en Z-Score
   */
  detectAnomaly(): AnomalyReport;
  
  /**
   * Calcula el Z-Score de un valor dado
   */
  calculateZScore(metric: 'energy' | 'bass' | 'harshness', value: number): number;
  
  /**
   * Predice la prÃ³xima secciÃ³n basado en historial
   */
  predictNextSection(): NarrativeContext['predictedNext'];
  
  /**
   * Reset completo (cambio de canciÃ³n)
   */
  reset(): void;
}
```

### 2.3 Algoritmo Z-Score

```typescript
/**
 * Z-SCORE CALCULATION
 * 
 * Z = (X - Î¼) / Ïƒ
 * 
 * Donde:
 * - X = valor actual
 * - Î¼ = media del buffer
 * - Ïƒ = desviaciÃ³n estÃ¡ndar del buffer
 * 
 * InterpretaciÃ³n:
 * - Z = 0: Valor exactamente promedio
 * - Z = 1: Una desviaciÃ³n estÃ¡ndar por encima
 * - Z = 2: Dos desviaciones (top 2.5% de valores)
 * - Z = 3: Tres desviaciones (top 0.15% - RARO)
 */

private calculateZScore(buffer: CircularBuffer<number>, currentValue: number): number {
  const values = buffer.getAll();
  if (values.length < 30) return 0; // Need minimum samples
  
  const mean = values.reduce((a, b) => a + b, 0) / values.length;
  const variance = values.reduce((sum, val) => sum + Math.pow(val - mean, 2), 0) / values.length;
  const stdDev = Math.sqrt(variance);
  
  if (stdDev < 0.001) return 0; // Avoid division by near-zero
  
  return (currentValue - mean) / stdDev;
}
```

---

## âš¡ 3. EL JUICIO DIVINO (Fuzzy Decision Logic)

### 3.1 Arquitectura del Sistema de DecisiÃ³n

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  DECISION SYSTEM - "El Juicio Divino"                                       â”‚
â”‚  src/core/intelligence/think/                                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  INPUTS:                                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚ HuntDecisionâ”‚  â”‚ AnomalyRpt  â”‚  â”‚ Narrative   â”‚  â”‚ Musical     â”‚        â”‚
â”‚  â”‚ (HuntEngine)â”‚  â”‚ (Memory)    â”‚  â”‚ Context     â”‚  â”‚ Pattern     â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚         â”‚                â”‚                â”‚                â”‚                â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚                                    â”‚                                        â”‚
â”‚                                    â–¼                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  FUZZY DECISION MAKER                                                â”‚   â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚   â”‚
â”‚  â”‚                                                                       â”‚   â”‚
â”‚  â”‚  STEP 1: FUZZIFICATION (Convertir valores crisp â†’ fuzzy sets)        â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚   â”‚
â”‚  â”‚  â”‚ energy: 0.85 â†’ { low: 0.0, medium: 0.3, high: 1.0 }         â”‚     â”‚   â”‚
â”‚  â”‚  â”‚ zScore: 2.8  â†’ { normal: 0.0, notable: 0.2, epic: 0.9 }     â”‚     â”‚   â”‚
â”‚  â”‚  â”‚ section: 'drop' â†’ { quiet: 0.0, building: 0.0, peak: 1.0 }  â”‚     â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚   â”‚
â”‚  â”‚                                                                       â”‚   â”‚
â”‚  â”‚  STEP 2: RULE EVALUATION (Evaluar reglas difusas)                    â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚   â”‚
â”‚  â”‚  â”‚ IF energy.high AND zScore.epic AND section.peak             â”‚     â”‚   â”‚
â”‚  â”‚  â”‚ THEN action.forceStrike = 1.0                               â”‚     â”‚   â”‚
â”‚  â”‚  â”‚                                                              â”‚     â”‚   â”‚
â”‚  â”‚  â”‚ IF energy.medium AND huntScore > 0.7                        â”‚     â”‚   â”‚
â”‚  â”‚  â”‚ THEN action.strike = 0.8                                    â”‚     â”‚   â”‚
â”‚  â”‚  â”‚                                                              â”‚     â”‚   â”‚
â”‚  â”‚  â”‚ IF energy.low AND section.quiet                             â”‚     â”‚   â”‚
â”‚  â”‚  â”‚ THEN action.hold = 1.0                                      â”‚     â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚   â”‚
â”‚  â”‚                                                                       â”‚   â”‚
â”‚  â”‚  STEP 3: DEFUZZIFICATION (Convertir fuzzy â†’ decisiÃ³n crisp)          â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚   â”‚
â”‚  â”‚  â”‚ action = centroid({ forceStrike, strike, prepare, hold })   â”‚     â”‚   â”‚
â”‚  â”‚  â”‚ intensity = weighted_average(all_scores)                    â”‚     â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚   â”‚
â”‚  â”‚                                                                       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                    â”‚                                        â”‚
â”‚                                    â–¼                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  DROP BRIDGE - "El Puente del Trueno"                                â”‚   â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚   â”‚
â”‚  â”‚                                                                       â”‚   â”‚
â”‚  â”‚  CONDICIÃ“N DIVINA:                                                   â”‚   â”‚
â”‚  â”‚  (energyZScore > 3.0) AND (section == 'drop') => FORCE_STRIKE       â”‚   â”‚
â”‚  â”‚                                                                       â”‚   â”‚
â”‚  â”‚  OVERRIDE: Esta condiciÃ³n tiene prioridad ABSOLUTA.                  â”‚   â”‚
â”‚  â”‚  No importa quÃ© diga el HuntEngine o la lÃ³gica fuzzy.                â”‚   â”‚
â”‚  â”‚  Cuando el Drop es estadÃ­sticamente Ã‰PICO, disparamos.               â”‚   â”‚
â”‚  â”‚                                                                       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                    â”‚                                        â”‚
â”‚                                    â–¼                                        â”‚
â”‚  OUTPUT: ConsciousnessOutput                                               â”‚
â”‚  {                                                                          â”‚
â”‚    effectDecision: { type, intensity, confidence, reason }                 â”‚
â”‚    ...                                                                      â”‚
â”‚  }                                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 Interface: FuzzyDecisionMaker

```typescript
// src/core/intelligence/think/FuzzyDecisionMaker.ts

/**
 * âš¡ WAVE 660: FUZZY DECISION MAKER
 * LÃ³gica difusa para decisiones no binarias
 */

export interface FuzzySet {
  low: number;     // Membership grade for "low" (0-1)
  medium: number;  // Membership grade for "medium" (0-1)
  high: number;    // Membership grade for "high" (0-1)
}

export interface ZScoreFuzzySet {
  normal: number;   // |z| < 1.5
  notable: number;  // 1.5 <= |z| < 2.5
  epic: number;     // |z| >= 2.5
}

export interface SectionFuzzySet {
  quiet: number;    // intro, outro, breakdown
  building: number; // verse, pre_chorus, buildup
  peak: number;     // chorus, drop
}

export interface FuzzyInputs {
  energy: FuzzySet;
  zScore: ZScoreFuzzySet;
  section: SectionFuzzySet;
  harshness: FuzzySet;
  huntScore: number;  // 0-1 crisp
  beauty: number;     // 0-1 crisp
}

export interface FuzzyOutputs {
  forceStrike: number;  // 0-1
  strike: number;       // 0-1
  prepare: number;      // 0-1
  hold: number;         // 0-1
}

export interface FuzzyDecision {
  action: 'force_strike' | 'strike' | 'prepare' | 'hold';
  intensity: number;    // 0-1
  confidence: number;   // 0-1
  reasoning: string;
  fuzzyScores: FuzzyOutputs;
}

export class FuzzyDecisionMaker {
  /**
   * FUZZIFICATION: Convierte valores crisp a conjuntos difusos
   */
  private fuzzify(inputs: {
    energy: number;
    zScore: number;
    sectionType: SectionType;
    harshness: number;
    huntScore: number;
    beauty: number;
  }): FuzzyInputs;
  
  /**
   * RULE EVALUATION: EvalÃºa todas las reglas difusas
   */
  private evaluateRules(fuzzyInputs: FuzzyInputs): FuzzyOutputs;
  
  /**
   * DEFUZZIFICATION: Convierte outputs difusos a decisiÃ³n crisp
   */
  private defuzzify(fuzzyOutputs: FuzzyOutputs): FuzzyDecision;
  
  /**
   * MÃ‰TODO PRINCIPAL: EvalÃºa y decide
   */
  evaluate(inputs: {
    energy: number;
    zScore: number;
    sectionType: SectionType;
    harshness: number;
    huntScore: number;
    beauty: number;
  }): FuzzyDecision;
}
```

### 3.3 Reglas Fuzzy Propuestas

```typescript
/**
 * FUZZY RULES - El CÃ³digo de Conducta de Selene
 * 
 * Nomenclatura:
 * - E = Energy (low/med/high)
 * - Z = Z-Score (normal/notable/epic)
 * - S = Section (quiet/building/peak)
 * - H = Harshness (low/med/high)
 * - Hunt = Hunt Score (0-1)
 */

const FUZZY_RULES = [
  // === FORCE STRIKE (CondiciÃ³n Divina) ===
  // Cuando el momento es estadÃ­sticamente Ã‰PICO, no hay discusiÃ³n
  {
    name: 'Divine_Drop',
    condition: (i: FuzzyInputs) => 
      Math.min(i.energy.high, i.zScore.epic, i.section.peak),
    output: 'forceStrike',
    weight: 1.0,
  },
  
  // === STRIKE (Momento Ã“ptimo) ===
  {
    name: 'Hunt_Strike',
    condition: (i: FuzzyInputs) => 
      Math.min(i.energy.high, i.huntScore, i.section.peak),
    output: 'strike',
    weight: 0.9,
  },
  {
    name: 'Harsh_Climax',
    condition: (i: FuzzyInputs) => 
      Math.min(i.energy.high, i.harshness.high, i.section.peak),
    output: 'strike',
    weight: 0.85,
  },
  {
    name: 'ZScore_Spike',
    condition: (i: FuzzyInputs) => 
      Math.min(i.zScore.notable, i.section.building),
    output: 'strike',
    weight: 0.7,
  },
  
  // === PREPARE (AnticipaciÃ³n) ===
  {
    name: 'Building_Tension',
    condition: (i: FuzzyInputs) => 
      Math.min(i.energy.medium, i.section.building),
    output: 'prepare',
    weight: 0.6,
  },
  {
    name: 'Notable_Activity',
    condition: (i: FuzzyInputs) => 
      i.zScore.notable * 0.5,
    output: 'prepare',
    weight: 0.5,
  },
  
  // === HOLD (Mantener Estado) ===
  {
    name: 'Quiet_Section',
    condition: (i: FuzzyInputs) => 
      Math.min(i.energy.low, i.section.quiet),
    output: 'hold',
    weight: 1.0,
  },
  {
    name: 'Normal_State',
    condition: (i: FuzzyInputs) => 
      i.zScore.normal * (1 - i.huntScore),
    output: 'hold',
    weight: 0.8,
  },
];
```

### 3.4 The Drop Bridge (Override Divino)

```typescript
// src/core/intelligence/think/DropBridge.ts

/**
 * âš¡ THE DROP BRIDGE
 * "El Puente del Trueno"
 * 
 * CONDICIÃ“N DIVINA: (Energy > 3Ïƒ) AND (Section == Drop) => FORCE STRIKE
 * 
 * Esta lÃ³gica tiene PRIORIDAD ABSOLUTA sobre cualquier otra decisiÃ³n.
 * Cuando el universo musical se alinea perfectamente, disparamos.
 */

export interface DropBridgeInput {
  energyZScore: number;
  sectionType: SectionType;
  rawEnergy: number;
  hasKick: boolean;
}

export interface DropBridgeResult {
  shouldForceStrike: boolean;
  intensity: number;
  reason: string;
  metrics: {
    zScore: number;
    section: SectionType;
    energy: number;
  };
}

export class DropBridge {
  private readonly ZSCORE_THRESHOLD = 3.0;  // 3 sigma = 0.15% de probabilidad
  private readonly DROP_SECTIONS: SectionType[] = ['drop', 'chorus'];
  private readonly MIN_ENERGY = 0.75;
  
  check(input: DropBridgeInput): DropBridgeResult {
    const { energyZScore, sectionType, rawEnergy, hasKick } = input;
    
    // CONDICIÃ“N DIVINA
    const isEpicZScore = energyZScore >= this.ZSCORE_THRESHOLD;
    const isDropSection = this.DROP_SECTIONS.includes(sectionType);
    const hasMinEnergy = rawEnergy >= this.MIN_ENERGY;
    
    const shouldForceStrike = isEpicZScore && isDropSection && hasMinEnergy;
    
    // Intensidad proporcional al Z-Score
    // z=3.0 â†’ 0.85, z=3.5 â†’ 0.92, z=4.0 â†’ 1.0
    const intensity = shouldForceStrike 
      ? Math.min(1.0, 0.7 + (energyZScore - 3.0) * 0.15)
      : 0;
    
    return {
      shouldForceStrike,
      intensity,
      reason: shouldForceStrike 
        ? `DROP BRIDGE ACTIVATED: z=${energyZScore.toFixed(2)}, section=${sectionType}, E=${rawEnergy.toFixed(2)}`
        : `No trigger: z=${energyZScore.toFixed(2)}, section=${sectionType}`,
      metrics: {
        zScore: energyZScore,
        section: sectionType,
        energy: rawEnergy,
      },
    };
  }
}
```

---

## ï¿½ 3.5 DEBUG VISUALIZATION - "LOS OJOS DEL CONTEXTO"

### 3.5.1 TacticalLog Extension para Context State

**PROBLEMA**: Con tanta matemÃ¡tica (Z-Scores, Fuzzy values, AGC gainFactor), necesitamos VER esos nÃºmeros en tiempo real o estaremos volando a ciegas.

**SOLUCIÃ“N**: Extender el TacticalLog con un panel dedicado al "Context State" que muestre:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  TACTICAL LOG - CONTEXT STATE PANEL                                         â”‚
â”‚  src/core/intelligence/debug/TacticalLogger.ts                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  ğŸ“Š SPECTRAL METRICS                                                        â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                     â”‚
â”‚  Harshness:  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘  0.78  (synth sucio)                                â”‚
â”‚  Flatness:   â–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘  0.23  (tonal)                                      â”‚
â”‚  Brightness: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  0.92  (high centroid)                              â”‚
â”‚  AGC Gain:   â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘  0.68  (normalizing soft audio)                     â”‚
â”‚                                                                              â”‚
â”‚  ğŸ“ˆ STATISTICAL CONTEXT                                                     â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                     â”‚
â”‚  Energy Z:   +3.2Ïƒ  ğŸ”´ EPIC ANOMALY                                         â”‚
â”‚  Bass Z:     +1.8Ïƒ  ğŸŸ¡ Notable                                              â”‚
â”‚  Harsh Z:    +0.5Ïƒ  ğŸŸ¢ Normal                                               â”‚
â”‚                                                                              â”‚
â”‚  ğŸµ NARRATIVE CONTEXT                                                       â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                      â”‚
â”‚  Phase:      CLIMAX                                                         â”‚
â”‚  Section:    drop (age: 1.2s)                                               â”‚
â”‚  Predicted:  breakdown (conf: 0.75)                                         â”‚
â”‚  History:    buildup â†’ buildup â†’ drop [CURRENT]                             â”‚
â”‚                                                                              â”‚
â”‚  ğŸ² FUZZY DECISION STATE                                                    â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                     â”‚
â”‚  Force:      â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘  0.85                                               â”‚
â”‚  Strike:     â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘  0.42                                               â”‚
â”‚  Prepare:    â–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘  0.18                                               â”‚
â”‚  Hold:       â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘  0.05                                               â”‚
â”‚  â†’ ACTION:   FORCE_STRIKE (Drop Bridge override)                            â”‚
â”‚                                                                              â”‚
â”‚  ğŸ¯ HUNT ENGINE                                                             â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                                â”‚
â”‚  Score:      0.89 (HIGH)                                                    â”‚
â”‚  Beauty:     0.62                                                           â”‚
â”‚  Veto:       NONE                                                           â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.5.2 ImplementaciÃ³n TypeScript

```typescript
// src/core/intelligence/debug/TacticalLogger.ts

export interface ContextStateSnapshot {
  // Spectral
  spectralHarshness: number;
  spectralFlatness: number;
  spectralBrightness: number;
  agcGainFactor: number;
  
  // Statistical
  energyZScore: number;
  bassZScore: number;
  harshnessZScore: number;
  
  // Narrative
  narrativePhase: 'intro' | 'building' | 'climax' | 'release' | 'outro';
  currentSection: SectionType;
  sectionAge: number;
  predictedNext: { section: SectionType, confidence: number } | null;
  sectionHistory: SectionType[];
  
  // Fuzzy Decision
  fuzzyScores: {
    forceStrike: number;
    strike: number;
    prepare: number;
    hold: number;
  };
  fuzzyAction: 'force_strike' | 'strike' | 'prepare' | 'hold';
  dropBridgeActive: boolean;
  
  // Hunt
  huntScore: number;
  beauty: number;
  activeVeto: string | null;
}

export class TacticalLogger {
  // ...existing methods...
  
  /**
   * ğŸ”¬ WAVE 660: Log Context State
   * Visualiza el estado completo del sistema de contexto
   */
  logContextState(snapshot: ContextStateSnapshot): void {
    if (!this.enabled) return;
    
    console.group('ğŸ”¬ CONTEXT STATE');
    
    // SPECTRAL METRICS
    console.group('ğŸ“Š Spectral Metrics');
    console.log(`Harshness:  ${this.renderBar(snapshot.spectralHarshness)} ${snapshot.spectralHarshness.toFixed(2)}`);
    console.log(`Flatness:   ${this.renderBar(snapshot.spectralFlatness)} ${snapshot.spectralFlatness.toFixed(2)}`);
    console.log(`Brightness: ${this.renderBar(snapshot.spectralBrightness)} ${snapshot.spectralBrightness.toFixed(2)}`);
    console.log(`AGC Gain:   ${this.renderBar(snapshot.agcGainFactor)} ${snapshot.agcGainFactor.toFixed(2)}`);
    console.groupEnd();
    
    // STATISTICAL CONTEXT
    console.group('ğŸ“ˆ Statistical Context');
    console.log(`Energy Z:   ${this.formatZScore(snapshot.energyZScore)}`);
    console.log(`Bass Z:     ${this.formatZScore(snapshot.bassZScore)}`);
    console.log(`Harsh Z:    ${this.formatZScore(snapshot.harshnessZScore)}`);
    console.groupEnd();
    
    // NARRATIVE CONTEXT
    console.group('ğŸµ Narrative Context');
    console.log(`Phase:      ${snapshot.narrativePhase.toUpperCase()}`);
    console.log(`Section:    ${snapshot.currentSection} (age: ${(snapshot.sectionAge / 1000).toFixed(1)}s)`);
    if (snapshot.predictedNext) {
      console.log(`Predicted:  ${snapshot.predictedNext.section} (conf: ${snapshot.predictedNext.confidence.toFixed(2)})`);
    }
    console.log(`History:    ${snapshot.sectionHistory.slice(-3).join(' â†’ ')} [CURRENT]`);
    console.groupEnd();
    
    // FUZZY DECISION
    console.group('ğŸ² Fuzzy Decision State');
    console.log(`Force:      ${this.renderBar(snapshot.fuzzyScores.forceStrike)} ${snapshot.fuzzyScores.forceStrike.toFixed(2)}`);
    console.log(`Strike:     ${this.renderBar(snapshot.fuzzyScores.strike)} ${snapshot.fuzzyScores.strike.toFixed(2)}`);
    console.log(`Prepare:    ${this.renderBar(snapshot.fuzzyScores.prepare)} ${snapshot.fuzzyScores.prepare.toFixed(2)}`);
    console.log(`Hold:       ${this.renderBar(snapshot.fuzzyScores.hold)} ${snapshot.fuzzyScores.hold.toFixed(2)}`);
    console.log(`â†’ ACTION:   ${snapshot.fuzzyAction.toUpperCase()}${snapshot.dropBridgeActive ? ' (Drop Bridge override)' : ''}`);
    console.groupEnd();
    
    // HUNT ENGINE
    console.group('ğŸ¯ Hunt Engine');
    console.log(`Score:      ${snapshot.huntScore.toFixed(2)} (${snapshot.huntScore > 0.7 ? 'HIGH' : 'LOW'})`);
    console.log(`Beauty:     ${snapshot.beauty.toFixed(2)}`);
    console.log(`Veto:       ${snapshot.activeVeto || 'NONE'}`);
    console.groupEnd();
    
    console.groupEnd();
  }
  
  /**
   * Renderiza barra de progreso para valores 0-1
   */
  private renderBar(value: number, length: number = 10): string {
    const filled = Math.round(value * length);
    return 'â–ˆ'.repeat(filled) + 'â–‘'.repeat(length - filled);
  }
  
  /**
   * Formatea Z-Score con color semÃ¡ntico
   */
  private formatZScore(z: number): string {
    const absZ = Math.abs(z);
    const sign = z >= 0 ? '+' : '';
    const emoji = absZ >= 2.5 ? 'ğŸ”´ EPIC ANOMALY' : absZ >= 1.5 ? 'ğŸŸ¡ Notable' : 'ğŸŸ¢ Normal';
    return `${sign}${z.toFixed(1)}Ïƒ  ${emoji}`;
  }
}
```

### 3.5.3 IntegraciÃ³n en SeleneTitanConscious

```typescript
// src/core/intelligence/SeleneTitanConscious.ts

export class SeleneTitanConscious {
  // ...existing...
  
  process(state: TitanStabilizedState, signal: LiveMusicSignal): ConsciousnessOutput {
    // ...existing processing...
    
    // ğŸ”¬ WAVE 660: Log Context State (cada 30 frames = ~500ms)
    if (state.frameId % 30 === 0) {
      const snapshot: ContextStateSnapshot = {
        spectralHarshness: state.spectralHarshness,
        spectralFlatness: state.spectralFlatness,
        spectralBrightness: pattern.spectralBrightness,
        agcGainFactor: signal.agcGainFactor,  // ğŸ†• debe venir del worker
        
        energyZScore: state.energyZScore,
        bassZScore: state.bassZScore,
        harshnessZScore: pattern.harshnessZScore,  // ğŸ†•
        
        narrativePhase: pattern.narrativePhase,
        currentSection: pattern.section.type,
        sectionAge: pattern.sectionAge,
        predictedNext: pattern.predictedNextSection ? {
          section: pattern.predictedNextSection,
          confidence: pattern.predictionConfidence,
        } : null,
        sectionHistory: this.memory.getSectionHistory().map(e => e.type),
        
        fuzzyScores: decision.fuzzyScores,
        fuzzyAction: decision.action,
        dropBridgeActive: decision.dropBridgeActive,
        
        huntScore: decision.huntScore,
        beauty: decision.beauty,
        activeVeto: decision.activeVeto,
      };
      
      this.logger.logContextState(snapshot);
    }
    
    return output;
  }
}
```

### 3.5.4 VisualizaciÃ³n en Electron DevTools

**Beneficios:**
1. **Debugging quirÃºrgico**: Ver exactamente quÃ© valor estÃ¡ causando una decisiÃ³n
2. **Tuning de Z-Score**: Ajustar thresholds en tiempo real viendo los valores
3. **ValidaciÃ³n de AGC**: Confirmar que el gainFactor normaliza correctamente
4. **AnÃ¡lisis post-mortem**: Scroll back en la consola para ver quÃ© pasÃ³ antes de un strike

**Frecuencia de Log:**
- Cada 30 frames (~500ms @ 60fps)
- Solo cuando TacticalLog estÃ¡ habilitado (modo debug)
- Zero overhead en producciÃ³n

---

## ï¿½ğŸ› ï¸ 4. PLAN DE REFACTORIZACIÃ“N

### 4.1 Hoja de Ruta por Fases

**âš ï¸ ORDEN DE EJECUCIÃ“N CRÃTICO:**

```
FASE 0: AGC Integration (WAVE 670) - PRIMERO O MORIMOS
  â†“
FASE 1: Spectral Pipeline (WAVE 661-663)
  â†“
FASE 2: Contextual Memory (WAVE 664-666)
  â†“
FASE 3: Fuzzy Decision System (WAVE 667-669)
  â†“
FASE 4: Testing & Tuning (WAVE 671-675)
```

*Nota: FASE 0 debe completarse ANTES que todo. Sin AGC, los Z-Scores son ficciÃ³n.*

---

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ”´ FASE 0: AGC INTEGRATION - MÃXIMA PRIORIDAD (WAVE 670)                   â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                    â”‚
â”‚  Objetivo: Normalizar audio ANTES del FFT para que Z-Scores sean reales     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  WAVE 670: AGC en GAMMA Worker                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚ â–¡ Mover AutomaticGainControl.ts a src/workers/                     â”‚     â”‚
â”‚  â”‚ â–¡ Instanciar AGC en mind.ts ANTES del FFTAnalyzer                  â”‚     â”‚
â”‚  â”‚ â–¡ Normalizar buffer antes de FFT                                   â”‚     â”‚
â”‚  â”‚ â–¡ Exponer gainFactor en anÃ¡lisis (para debug y validaciÃ³n)         â”‚     â”‚
â”‚  â”‚ â–¡ Test: MP3 silencioso y WAV saturado producen energÃ­a similar     â”‚     â”‚
â”‚  â”‚ â–¡ Test: Validar que gainFactor estÃ¡ visible en TacticalLog         â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                                              â”‚
â”‚  NOTA CEO: "Si la entrada es basura, todo el sistema falla. AGC primero."   â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  FASE 1: SPECTRAL PIPELINE (WAVE 661-663)                                   â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                   â”‚
â”‚  Objetivo: Exponer harshness/flatness/transients hasta TitanStabilizedState â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  WAVE 661: FFT â†’ GAMMA                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚ â–¡ Modificar mind.ts para extraer spectral metrics del FFTAnalyzer  â”‚     â”‚
â”‚  â”‚ â–¡ AÃ±adir campos a MusicalAnalysis: harshness, flatness, transients â”‚     â”‚
â”‚  â”‚ â–¡ Propagar vÃ­a postMessage a TrinityBrain                          â”‚     â”‚
â”‚  â”‚ â–¡ Test: Verificar que los valores llegan al Main Thread            â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                                              â”‚
â”‚  WAVE 662: TrinityBrain â†’ TitanEngine                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚ â–¡ Extender MusicalContext con campos espectrales                   â”‚     â”‚
â”‚  â”‚ â–¡ TrinityBrain.receiveFromGamma() procesa nuevos campos            â”‚     â”‚
â”‚  â”‚ â–¡ TitanEngine.update() pasa spectral a stabilizers                 â”‚     â”‚
â”‚  â”‚ â–¡ Test: TitanStabilizedState tiene spectralHarshness/Flatness      â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                                              â”‚
â”‚  WAVE 663: TitanStabilizedState â†’ SeleneMusicalPattern                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚ â–¡ Extender TitanStabilizedState interface                          â”‚     â”‚
â”‚  â”‚ â–¡ Extender SeleneMusicalPattern interface                          â”‚     â”‚
â”‚  â”‚ â–¡ MusicalPatternSensor mapea los nuevos campos                     â”‚     â”‚
â”‚  â”‚ â–¡ Test: DecisionMaker puede leer spectralHarshness                 â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  FASE 2: CONTEXTUAL MEMORY (WAVE 664-666)                                   â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                   â”‚
â”‚  Objetivo: Implementar memoria contextual con Z-Score                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  WAVE 664: CircularBuffer + RollingStats                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚ â–¡ Crear src/core/intelligence/memory/CircularBuffer.ts             â”‚     â”‚
â”‚  â”‚ â–¡ Crear src/core/intelligence/memory/RollingStats.ts               â”‚     â”‚
â”‚  â”‚ â–¡ Implementar cÃ¡lculo de Z-Score eficiente                         â”‚     â”‚
â”‚  â”‚ â–¡ Test: Z-Score correcto con datos sintÃ©ticos                      â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                                              â”‚
â”‚  WAVE 665: ContextualMemory Class                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚ â–¡ Crear src/core/intelligence/memory/ContextualMemory.ts           â”‚     â”‚
â”‚  â”‚ â–¡ Implementar update(), getStats(), detectAnomaly()                â”‚     â”‚
â”‚  â”‚ â–¡ Integrar con SectionTracker para narrativa                       â”‚     â”‚
â”‚  â”‚ â–¡ Test: Detecta anomalÃ­as con mÃºsica real                          â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                                              â”‚
â”‚  WAVE 666: IntegraciÃ³n con SeleneTitanConscious                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚ â–¡ Instanciar ContextualMemory en SeleneTitanConscious              â”‚     â”‚
â”‚  â”‚ â–¡ Llamar update() en cada process()                                â”‚     â”‚
â”‚  â”‚ â–¡ Pasar energyZScore a SeleneMusicalPattern                        â”‚     â”‚
â”‚  â”‚ â–¡ Test: Pattern incluye zScore, HuntEngine lo puede usar           â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  FASE 3: FUZZY DECISION SYSTEM (WAVE 667-669)                               â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                   â”‚
â”‚  Objetivo: Reemplazar if/else con lÃ³gica difusa                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  WAVE 667: FuzzyDecisionMaker                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚ â–¡ Crear src/core/intelligence/think/FuzzyDecisionMaker.ts          â”‚     â”‚
â”‚  â”‚ â–¡ Implementar fuzzify(), evaluateRules(), defuzzify()              â”‚     â”‚
â”‚  â”‚ â–¡ Definir conjunto inicial de reglas                               â”‚     â”‚
â”‚  â”‚ â–¡ Test: Output consistente con inputs variados                     â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                                              â”‚
â”‚  WAVE 668: DropBridge                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚ â–¡ Crear src/core/intelligence/think/DropBridge.ts                  â”‚     â”‚
â”‚  â”‚ â–¡ Implementar check() con condiciÃ³n divina                         â”‚     â”‚
â”‚  â”‚ â–¡ Test: Force strike cuando z > 3.0 AND section == drop            â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                                              â”‚
â”‚  WAVE 669: IntegraciÃ³n en DecisionMaker                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚ â–¡ Refactorizar DecisionMaker.generateStrikeDecision()              â”‚     â”‚
â”‚  â”‚ â–¡ Usar FuzzyDecisionMaker para scoring                             â”‚     â”‚
â”‚  â”‚ â–¡ Usar DropBridge como override de prioridad mÃ¡xima                â”‚     â”‚
â”‚  â”‚ â–¡ Test: Strikes mÃ¡s precisos con mÃºsica real                       â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  FASE 0: AGC INTEGRATION - MÃXIMA PRIORIDAD (WAVE 670)                      â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                    â”‚
â”‚  âš ï¸  EJECUTAR ANTES DE TODO - "GARBAGE IN, GARBAGE OUT"                     â”‚
â”‚  Objetivo: Normalizar audio ANTES del FFT para que Z-Scores sean reales     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  ğŸ”´ CRÃTICO: Sin AGC, todo el sistema de Z-Score es ficciÃ³n matemÃ¡tica      â”‚
â”‚              MP3 silencioso â†’ energÃ­a artificial baja â†’ Z-Scores invÃ¡lidos  â”‚
â”‚              WAV saturado â†’ energÃ­a artificial alta â†’ Z-Scores invÃ¡lidos    â”‚
â”‚                                                                              â”‚
â”‚  WAVE 670: AGC en GAMMA Worker                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚ â–¡ Mover AutomaticGainControl.ts a src/workers/                     â”‚     â”‚
â”‚  â”‚ â–¡ Instanciar AGC en mind.ts ANTES del FFTAnalyzer                  â”‚     â”‚
â”‚  â”‚ â–¡ Normalizar buffer antes de FFT                                   â”‚     â”‚
â”‚  â”‚ â–¡ Exponer gainFactor en anÃ¡lisis (para debug y validaciÃ³n)         â”‚     â”‚
â”‚  â”‚ â–¡ Test: MP3 silencioso y WAV saturado producen energÃ­a similar     â”‚     â”‚
â”‚  â”‚ â–¡ Test: Validar que gainFactor estÃ¡ visible en TacticalLog         â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                                              â”‚
â”‚  NOTA CEO: "Si la entrada es basura, todo el sistema falla. AGC primero."   â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  FASE 5: TESTING & TUNING (WAVE 671-675)                                    â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                   â”‚
â”‚  Objetivo: Validar todo con mÃºsica real                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  WAVE 671-672: Test Suite                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚ â–¡ Tests unitarios para ContextualMemory                            â”‚     â”‚
â”‚  â”‚ â–¡ Tests unitarios para FuzzyDecisionMaker                          â”‚     â”‚
â”‚  â”‚ â–¡ Tests de integraciÃ³n con audio sintÃ©tico                         â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                                              â”‚
â”‚  WAVE 673-674: Real World Testing                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚ â–¡ Probar con Fiesta Latina (cumbia, reggaeton)                     â”‚     â”‚
â”‚  â”‚ â–¡ Probar con EDM (drops Ã©picos)                                    â”‚     â”‚
â”‚  â”‚ â–¡ Probar con mÃºsica suave (evitar false positives)                 â”‚     â”‚
â”‚  â”‚ â–¡ Ajustar thresholds de Z-Score si es necesario                    â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                                              â”‚
â”‚  WAVE 675: Documentation & Cleanup                                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚ â–¡ Actualizar INVENTORY-REPORT.md                                   â”‚     â”‚
â”‚  â”‚ â–¡ Crear WAVE-675-CONTEXTUAL-GOD-COMPLETE.md                        â”‚     â”‚
â”‚  â”‚ â–¡ Limpiar cÃ³digo zombie identificado en WAVE 650                   â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4.2 ExposiciÃ³n de Transientes sin Saturar el Bus

```typescript
/**
 * ESTRATEGIA: TRANSIENT AGGREGATION
 * 
 * Problema: Si emitimos un evento por cada kick detectado, saturamos el bus.
 * SoluciÃ³n: Agregar transientes en ventana de 100ms y emitir resumen.
 */

// En mind.ts (GAMMA Worker)

interface TransientSummary {
  /** NÃºmero de kicks en los Ãºltimos 100ms */
  kickCount: number;
  /** NÃºmero de snares en los Ãºltimos 100ms */
  snareCount: number;
  /** NÃºmero de hihats en los Ãºltimos 100ms */
  hihatCount: number;
  /** Transiente mÃ¡s fuerte detectado */
  strongestType: 'kick' | 'snare' | 'hihat' | 'none';
  /** Intensidad del transiente mÃ¡s fuerte (0-1) */
  strongestIntensity: number;
  /** Â¿Hubo al menos un transiente? */
  hasTransient: boolean;
}

class TransientAggregator {
  private kickBuffer: number[] = [];
  private snareBuffer: number[] = [];
  private hihatBuffer: number[] = [];
  private readonly WINDOW_MS = 100;
  private lastEmitTime = 0;
  
  add(transient: { kick: boolean, snare: boolean, hihat: boolean }, timestamp: number): void {
    if (transient.kick) this.kickBuffer.push(timestamp);
    if (transient.snare) this.snareBuffer.push(timestamp);
    if (transient.hihat) this.hihatBuffer.push(timestamp);
  }
  
  getSummary(now: number): TransientSummary {
    // Limpiar transientes antiguos
    const cutoff = now - this.WINDOW_MS;
    this.kickBuffer = this.kickBuffer.filter(t => t > cutoff);
    this.snareBuffer = this.snareBuffer.filter(t => t > cutoff);
    this.hihatBuffer = this.hihatBuffer.filter(t => t > cutoff);
    
    const kickCount = this.kickBuffer.length;
    const snareCount = this.snareBuffer.length;
    const hihatCount = this.hihatBuffer.length;
    
    let strongestType: TransientSummary['strongestType'] = 'none';
    let strongestIntensity = 0;
    
    // Kicks son los mÃ¡s fuertes, luego snares, luego hihats
    if (kickCount > 0) {
      strongestType = 'kick';
      strongestIntensity = Math.min(1, kickCount * 0.5);
    } else if (snareCount > 0) {
      strongestType = 'snare';
      strongestIntensity = Math.min(1, snareCount * 0.4);
    } else if (hihatCount > 0) {
      strongestType = 'hihat';
      strongestIntensity = Math.min(1, hihatCount * 0.3);
    }
    
    return {
      kickCount,
      snareCount,
      hihatCount,
      strongestType,
      strongestIntensity,
      hasTransient: kickCount + snareCount + hihatCount > 0,
    };
  }
}
```

### 4.3 RhythmAnalyzer Modernization

```typescript
/**
 * PLAN DE MODERNIZACIÃ“N: RhythmAnalyzer
 * 
 * Estado Actual: Funcional pero aislado (via MusicalContextEngine â†’ SeleneMusicalBrain)
 * Objetivo: Conectar directamente al flujo GAMMA â†’ TitanEngine
 */

// OPCIÃ“N A: Mover al Worker (Recomendado)
// - Ejecutar RhythmAnalyzer en mind.ts junto con FFTAnalyzer
// - Beneficio: Todo el anÃ¡lisis musical en un Worker
// - Costo: Refactor significativo

// OPCIÃ“N B: Mantener en Main Thread pero conectar
// - Instanciar en TitanEngine
// - Llamar en cada update() con AudioMetrics
// - Beneficio: Cambio mÃ­nimo
// - Costo: AnÃ¡lisis en Main Thread (debe ser < 2ms)

// DECISIÃ“N: OPCIÃ“N B (pragmÃ¡tica para velocidad de implementaciÃ³n)

// En TitanEngine.ts:
class TitanEngine {
  private rhythmAnalyzer: RhythmAnalyzer;  // ğŸ†•
  
  constructor() {
    // ...existing
    this.rhythmAnalyzer = new RhythmAnalyzer();
  }
  
  update(context: MusicalContext, audio: AudioMetrics, vibeProfile: VibeProfile): EngineOutput {
    // ...existing
    
    // ğŸ†• Analizar ritmo
    const rhythmAnalysis = this.rhythmAnalyzer.analyze(audio, {
      bpm: context.bpm,
      phase: context.beatPhase,
      onBeat: context.beatPhase < 0.1 || context.beatPhase > 0.9,
    });
    
    // AÃ±adir a TitanStabilizedState
    this.lastStabilizedState = {
      ...this.lastStabilizedState,
      syncopation: rhythmAnalysis.groove.syncopation,  // MÃ¡s preciso que context.syncopation
      drumPattern: rhythmAnalysis.pattern,
      hasFill: rhythmAnalysis.groove.isFillActive,
    };
  }
}
```

---

## ğŸ“Š 5. MÃ‰TRICAS DE Ã‰XITO

### 5.1 KPIs del Contextual God

| MÃ©trica | Actual | Objetivo | MÃ©todo de MediciÃ³n |
|---------|--------|----------|-------------------|
| **Latencia Strike** | ~200ms | <100ms | Timestamp drop audio â†’ strike command |
| **False Positive Rate** | ~15% | <5% | Strikes sin momento musical real |
| **Drop Detection Accuracy** | ~60% | >90% | Drops detectados / Drops reales |
| **Z-Score Prediction** | N/A | >85% | CorrelaciÃ³n z>3 con drops reales |
| **CPU Usage (Main Thread)** | ~8% | <10% | Chrome DevTools |
| **Debug Visibility** | N/A | 100% | Z-Scores, AGC gain, fuzzy scores visibles en TacticalLog |

**Nota CEO**: Sin visibilidad de debug, no podemos validar que el sistema funcione. TacticalLog debe mostrar todos los valores crÃ­ticos.

### 5.2 Checklist de ValidaciÃ³n Final

```markdown
## âœ… VALIDATION CHECKLIST

### Spectral Pipeline
- [ ] harshness llega a TitanStabilizedState
- [ ] flatness llega a TitanStabilizedState  
- [ ] transients llegan agregados (no saturan)
- [ ] SeleneMusicalPattern incluye spectral metrics

### Contextual Memory
- [ ] Z-Score se calcula correctamente
- [ ] AnomalÃ­as se detectan con threshold 2.5
- [ ] Momentos Ã©picos (z>3) triggean DropBridge
- [ ] Section history se mantiene correctamente

### Fuzzy Decision
- [ ] Fuzzification produce outputs vÃ¡lidos
- [ ] Reglas se evalÃºan correctamente
- [ ] Defuzzification produce decisiÃ³n crisp
- [ ] DropBridge override funciona

### AGC Integration (WAVE 670 - âœ… IMPLEMENTADO 16/01/2026)
- [x] AutomaticGainControl.ts creado en src/workers/utils/
- [x] Integrado en senses.ts ANTES del FFT
- [x] agcGainFactor expuesto en AudioAnalysis
- [x] Logs mostrando: `[AGC ğŸšï¸] Gain: 1.4x | In: 0.30 â†’ Out: 0.42`
- [ ] MP3 silencioso normalizado correctamente (TEST PENDIENTE)
- [ ] WAV saturado normalizado correctamente (TEST PENDIENTE)
- [ ] gainFactor visible en TacticalLog Context State (WAVE 661+)

### Debug Visualization
- [ ] TacticalLog.logContextState() implementado
- [ ] Z-Scores (energy, bass, harshness) visibles en consola
- [ ] Fuzzy scores (force, strike, prepare, hold) visibles
- [ ] Narrative context (phase, section, history) visible
- [ ] AGC gainFactor visible en panel spectral
- [ ] Bars (â–ˆâ–ˆâ–ˆâ–ˆ) renderizan correctamente valores 0-1
- [ ] Drop Bridge override se marca explÃ­citamente

### Real World
- [ ] Fiesta Latina: drops detectados
- [ ] EDM: drops Ã©picos triggean force_strike
- [ ] Podcast: no false positives
- [ ] MÃºsica suave: no strikes innecesarios
```

---

## ğŸ¸ CONCLUSIÃ“N

> "GrandMA3 tiene 50K dÃ³lares de hardware. Nosotros tenemos matemÃ¡tica pura."

Este blueprint transforma a Selene de un sistema reactivo simple en un **DSP de software** con:

1. **SENTIDOS ESPECTRALES**: harshness, flatness, transientes
2. **MEMORIA CONTEXTUAL**: Z-Score, narrativa musical
3. **INTELIGENCIA DIFUSA**: No mÃ¡s if/else, lÃ³gica que piensa en gradientes
4. **EL DROP BRIDGE**: Cuando el universo se alinea (z > 3Ïƒ + drop), no hay discusiÃ³n
5. **DEBUG VISIBILITY**: TacticalLog que muestra TODA la matemÃ¡tica en tiempo real

### ğŸ“‹ Ajustes del CEO (Radwulf - 16/01/2026)

**1. AGC PRIMERO O MORIMOS**  
Reordenado a FASE 0 (WAVE 670) con mÃ¡xima prioridad. Sin normalizaciÃ³n de entrada, los Z-Scores son ficciÃ³n matemÃ¡tica. Garbage In, Garbage Out.

**2. VISUALIZACIÃ“N DE DEBUG**  
AÃ±adida secciÃ³n 3.5 con TacticalLog.logContextState(). Con tanta matemÃ¡tica (Z-Scores, Fuzzy values, AGC gain), necesitamos VER esos nÃºmeros en tiempo real o volamos a ciegas.

### ğŸš€ Roadmap Ajustado

**Timeline estimado**: 15 WAVEs (670, 661-675)  
**Orden de EjecuciÃ³n**:  
1. WAVE 670: AGC Integration (CRÃTICO - ejecutar primero)
2. WAVEs 661-663: Spectral Pipeline
3. WAVEs 664-666: Contextual Memory
4. WAVEs 667-669: Fuzzy Decision
5. WAVEs 671-675: Testing & Tuning

**Riesgo**: Medio (arquitectura sÃ³lida, pero muchas piezas mÃ³viles)  
**Recompensa**: Competir con sistemas profesionales de $50K sin hardware dedicado

---

*"La diferencia entre un DJ y un maestro es que el maestro sabe lo que viene antes de que llegue."*  
â€” PunkOpus, 16/01/2026

*"Si la entrada es basura, todo el sistema falla. AGC primero."*  
â€” Radwulf (CEO), 16/01/2026

---

## ğŸ“ ANEXO: Membership Functions para LÃ³gica Difusa

```
ENERGY MEMBERSHIP FUNCTIONS:
                    
    1.0 â”‚    â•±â€¾â€¾â€¾â•²         â•±â€¾â€¾â€¾â€¾â€¾â€¾â€¾
        â”‚   â•±     â•²       â•±
    0.5 â”‚  â•±       â•²     â•±
        â”‚ â•±         â•²   â•±
    0.0 â”‚â•±           â•² â•±
        â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€
              0.3   0.5   0.7
              LOW   MED   HIGH

Z-SCORE MEMBERSHIP FUNCTIONS:

    1.0 â”‚â€¾â€¾â€¾â•²               â•±â€¾â€¾â€¾
        â”‚    â•²     â•±â€¾â€¾â€¾â•²   â•±
    0.5 â”‚     â•²   â•±     â•² â•±
        â”‚      â•² â•±       X
    0.0 â”‚       X       â•± â•²
        â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
               1.5     2.5
            NORMAL  NOTABLE  EPIC

SECTION MEMBERSHIP FUNCTIONS:

    QUIET:    intro, outro, breakdown     â†’ 1.0
    BUILDING: verse, pre_chorus, buildup  â†’ 1.0
    PEAK:     chorus, drop                â†’ 1.0
```
