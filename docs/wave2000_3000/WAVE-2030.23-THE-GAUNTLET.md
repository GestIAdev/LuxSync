# WAVE 2030.23: THE GAUNTLET â€” E2E Integration Test Suite

**Fecha**: 2026-02-12  
**Status**: âœ… 27/27 TESTS PASSING  
**Archivo**: `electron-app/src/core/hephaestus/__tests__/HephaestusE2E.test.ts`

---

## ğŸ¯ OBJETIVO

BaterÃ­a de tests de integraciÃ³n que verifica el pipeline completo:

```
.lfx Clip â†’ CurveEvaluator â†’ scaleToDMX â†’ Merge Strategy â†’ FixtureState â†’ Physics â†’ DMX
```

Si CUALQUIER parÃ¡metro se pierde en la cadena (como White en WAVE 2030.22g), el test grita en rojo.

---

## ğŸ§ª SUITE DE TESTS

### ğŸŒˆ PRUEBA 1: El ArcoÃ­ris Completo (10 tests)

Verifica que **todos los parÃ¡metros** viajan desde el clip hasta la salida final:

| ParÃ¡metro | Input | Expected DMX | Merge Strategy | Status |
|-----------|-------|-------------|----------------|--------|
| Intensity | 1.0   | 255         | HTP            | âœ… |
| Color     | h:0   | R:255,G:0,B:0 | LTP          | âœ… |
| White     | 1.0   | 255         | LTP            | âœ… |
| Amber     | 1.0   | 255         | LTP            | âœ… |
| Strobe    | 0.5   | 127-128     | Additive       | âœ… |

**Sub-tests incluidos:**
- `scaleToDMX()`: DMX params â†’ 0-255, engine params â†’ 0-1 float
- `scaleToDMX()`: Clamping de valores fuera de rango
- `hslToRgb()`: Rueda de color completa (R, G, B, Y, C, M, W, K)
- Intensity modulation: Dimming preserva hue

### ğŸ‹ï¸ PRUEBA 2: El Duelo de FÃ­sica (3 tests)

Verifica que `FixturePhysicsDriver` interpola movimiento y protege motores:

- **Check A (Intent)**: Pan=1.0 â†’ DMX 255 (sin fÃ­sica)
- **Check B (Safety)**: Con fÃ­sica Pop-Rock, Pan NO llega a 255 en frame 2
- **Tilt Safety**: LÃ­mites mecÃ¡nicos respetados (tiltMin/tiltMax)

**Datos reales del test (10 frames a 60fps):**
```
Start: 128 â†’ Target: 255
Frame 1:  PAN = 143 (11.8%)
Frame 2:  PAN = 158 (23.6%)
Frame 3:  PAN = 173 (35.4%)
Frame 4:  PAN = 188 (47.2%)
Frame 5:  PAN = 203 (59.1%)
Frame 6:  PAN = 218 (70.9%)
Frame 7:  PAN = 233 (82.7%)
Frame 8:  PAN = 245 (91.8%)
Frame 9:  PAN = 250 (96.1%)
Frame 10: PAN = 253 (98.1%)
```

### ğŸ§Ÿ PRUEBA 3: Zombie Check (8 tests)

Verifica la jerarquÃ­a de layers y recuperaciÃ³n:

- **LTP**: Hephaestus Pan=0.8 sobreescribe Vibe Pan=0.5
- **Recovery**: Al parar Hephaestus, Vibe vuelve
- **HTP alto gana**: Heph=200 vs Vibe=100 â†’ 200
- **HTP bajo pierde**: Heph=50 vs Vibe=100 â†’ 100
- **Additive Strobe**: 50 + 80 = 130
- **Strobe Clamp**: 200 + 200 = 255 (no overflow)
- **LTP Color**: Hephaestus RGB sobreescribe completamente
- **Zone Targeting**: Solo fixtures en la zona correcta afectados

### ğŸ”„ BONUS: CurveEvaluator Timing (4 tests)

- Linear interpolation en 5 puntos temporales
- Hold interpolation (step function)
- Edge case: tiempo negativo â†’ primer valor
- Edge case: tiempo > duraciÃ³n â†’ Ãºltimo valor

### ğŸ¯ BONUS 2: Full 10-Frame Pipeline (2 tests)

- Intensity ramp monotÃ³nicamente creciente
- Triple ramp: White + Amber + Dimmer sincronizados

---

## ğŸ—ï¸ ARQUITECTURA

### Componentes REALES usados (zero mocks de negocio):

| Componente | Rol |
|------------|-----|
| `CurveEvaluator` | EvaluaciÃ³n matemÃ¡tica de curvas BÃ©zier |
| `scaleToDMX()` | Escalado 0-1 â†’ 0-255 |
| `hslToRgb()` | ConversiÃ³n HSL â†’ RGB |
| `FixturePhysicsDriver` | InterpolaciÃ³n fÃ­sica de motores |

### Merge Strategy (replica de TitanOrchestrator):

| ParÃ¡metro | Estrategia | Detalle |
|-----------|------------|---------|
| Intensity | HTP | El mÃ¡s alto gana |
| Color     | LTP | Hephaestus sobreescribe |
| Pan/Tilt  | LTP | Overlay directo |
| Strobe    | Additive | Suma (clamp 255) |
| White/Amber | LTP | Overlay directo |

---

## ğŸ“Š MÃ‰TRICAS

- **27 tests** â€” 0 failures
- **19ms** total execution time
- **0 Math.random()** calls (Axioma Anti-SimulaciÃ³n)
- **0 filesystem** dependencies
- **0 Electron/IPC** dependencies
- **100%** deterministic â€” mismo input â†’ mismo output, siempre

---

## ğŸ”® FUTURO: Tests pendientes

1. **BÃ©zier interpolation precision** (Newton-Raphson accuracy)
2. **Audio binding modulation** (reactive keyframes)
3. **Multi-clip merging** (2+ clips simultÃ¡neos)
4. **16-bit movement** (panFine/tiltFine precision)
