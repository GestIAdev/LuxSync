# WAVE 2040.29 ‚Äî CINEMA CANONICAL + VISUAL UPGRADE

## üìã STATUS: ‚úÖ COMPLETADO

**Fecha**: 2025-01-XX  
**Archivo Modificado**: `chronos/ui/stage/StageSimulatorCinema.tsx`  
**Errores TypeScript**: 0

---

## üéØ OBJETIVOS

El StageSimulatorCinema era el √∫ltimo reducer visual que usaba el formato legacy de zonas (`MOVING_LEFT`) cuando el backend ya enviaba CanonicalZone (`movers-left`). Adem√°s, el render no diferenciaba visualmente entre PARs (wash fijo) y Movers (beam direccional).

### Problemas Identificados:
1. **Zone Mapping Roto**: `classifyZone()` buscaba `MOVING_LEFT` pero recib√≠a `movers-left`
2. **Sin Diferenciaci√≥n Visual**: PARs y Movers se renderizaban id√©nticos (ambos con beam triangular)
3. **Visual Power Insuficiente**: Fixtures peque√±os (radius 0.035), glow t√≠mido (2.5x), beams transparentes (0.25 alpha)

---

## üîß CAMBIOS IMPLEMENTADOS

### 1. CINEMA Constants ‚Äî Visual Power Upgrade

```typescript
// ANTES
const CINEMA = {
  FIXTURE_RADIUS_RATIO: 0.035,
  GLOW_MULTIPLIER: 2.5,
  ...
}

// DESPU√âS
const CINEMA = {
  FIXTURE_RADIUS_RATIO: 0.045,    // ‚Üë Fixtures m√°s grandes
  GLOW_MULTIPLIER: 3.5,           // ‚Üë Glow movers m√°s prominente
  PAR_GLOW_MULTIPLIER: 5.0,       // NEW ‚Äî PARs tienen glow extra difuso
  ...
}
```

### 2. classifyZone() ‚Äî Reconocimiento de Zonas Can√≥nicas

```typescript
// ANTES: Solo reconoc√≠a formato legacy
if (upper.includes('MOVING_LEFT') || upper === 'LEFT') { ... }

// DESPU√âS: Reconoce AMBOS formatos (legacy + canonical)
const normalized = (raw || '').toLowerCase().replace(/_/g, '-')

// MOVERS LEFT: "movers-left", "moving_left", "moving-left", "left"
if (normalized.includes('movers-left') || normalized.includes('moving-left') || normalized === 'left') {
  return { zone: 'MOVING_LEFT', type: 'moving' }
}
```

Ahora reconoce:
- `movers-left` ‚Üí MOVING_LEFT (mover)
- `movers-right` ‚Üí MOVING_RIGHT (mover)
- `front` / `pars-front` ‚Üí FRONT (par)
- `back` / `pars-back` ‚Üí BACK (par)
- `floor` ‚Üí FLOOR (wash)
- `ambient` ‚Üí AMBIENT (wash)
- `air` ‚Üí AIR (mover)
- `center` ‚Üí CENTER (par)
- `strobe` ‚Üí STROBES (strobe)

### 3. drawBeam() ‚Äî PARs NO Dibujan Haz Triangular

```typescript
// NUEVO: Early return para PARs/wash
if (type === 'par' || type === 'wash') return

// SOLO MOVERS dibujan el haz triangular
```

**L√≥gica**: Los PARs son wash fijo sin movimiento. Su luz es DIFUSA, no direccional. Todo su impacto visual viene del glow en `drawFixture()`. Los Movers s√≠ proyectan un haz direccional que se mueve con pan/tilt.

### 4. drawBeam() ‚Äî Beam Opacity Boost

```typescript
// ANTES
const alpha = intensity * 0.25  // Beams transl√∫cidos

// DESPU√âS
const alpha = intensity * 0.40  // Beams m√°s brillantes
```

### 5. drawFixture() ‚Äî PAR vs MOVER Visual Differentiation

```typescript
const isPar = type === 'par' || type === 'wash'
const glowMultiplier = isPar ? CINEMA.PAR_GLOW_MULTIPLIER : CINEMA.GLOW_MULTIPLIER

// Glow calculation
const glowR = fixtureRadius * (glowMultiplier + intensity * 1.5)

// PARs: glow m√°s suave y difuso | Movers: glow m√°s concentrado
const innerAlpha = isPar ? intensity * 0.45 : intensity * 0.55
const midAlpha = isPar ? intensity * 0.22 : intensity * 0.18

// GOBO y PRISM solo para movers
if (!isPar) {
  drawGoboIndicator(...)
  drawPrismIndicator(...)
}
```

---

## üìä RESULTADO VISUAL

### ANTES:
```
PARs:   ‚ñΩ (tri√°ngulo hacia abajo) + glow peque√±o
Movers: ‚ñΩ (tri√°ngulo hacia abajo) + glow peque√±o
```

### DESPU√âS:
```
PARs:   ‚ö™ (glow difuso grande, sin tri√°ngulo) ‚Äî representa wash
Movers: ‚ñΩ (beam triangular gordo + glow compacto) ‚Äî representa spot
```

---

## üî¨ VALIDACI√ìN

### TypeScript Compilation
```
StageSimulatorCinema.tsx ‚Üí 0 errores
```

### Cobertura de Zonas Can√≥nicas
| Backend Zone | Cinema Zone | Fixture Type |
|--------------|-------------|--------------|
| `movers-left` | MOVING_LEFT | moving |
| `movers-right` | MOVING_RIGHT | moving |
| `front` | FRONT | par |
| `back` | BACK | par |
| `floor` | FLOOR | wash |
| `ambient` | AMBIENT | wash |
| `air` | AIR | moving |
| `center` | CENTER | par |
| `strobe` | STROBES | strobe |

---

## üìù NOTAS T√âCNICAS

### Compatibilidad Backwards
El nuevo `classifyZone()` reconoce AMBOS formatos:
- Legacy: `MOVING_LEFT`, `MOVING_RIGHT`, `FRONT`, `BACK`...
- Canonical: `movers-left`, `movers-right`, `front`, `back`...

Esto permite que shows antiguos que tengan el formato legacy sigan funcionando.

### Performance Impact
Los cambios son puramente visuales ‚Äî no afectan la l√≥gica de negocio ni el pipeline de datos. El overhead adicional es m√≠nimo (un par de condicionales `isPar` por fixture por frame).

---

## üîó INTEGRACI√ìN CON WAVE SERIES

| Wave | Descripci√≥n | Status |
|------|-------------|--------|
| 2040.26 | Mass migration 42 effects | ‚úÖ Committed 698112d |
| 2040.27 | Type integrity validation | ‚úÖ |
| 2040.27a | Stereo PARs extension | ‚úÖ |
| 2040.27b | StageConstructor precision | ‚úÖ |
| 2040.28 | Hephaestus Duality (Modal + ZoneSelector) | ‚úÖ |
| **2040.29** | **Cinema Canonical + Visual** | ‚úÖ |

---

**PunkOpus** ‚Äî *OPERATION NATIVE TONGUE: Cinema Module Complete*
